!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("prop-types"),require("react"),require("@cassette/core"),require("resize-observer-polyfill")):"function"==typeof define&&define.amd?define(["prop-types","react","@cassette/core","resize-observer-polyfill"],t):"object"==typeof exports?exports.cassetteComponents=t(require("prop-types"),require("react"),require("@cassette/core"),require("resize-observer-polyfill")):e.cassetteComponents=t(e.PropTypes,e.React,e.cassetteCore,e.ResizeObserver)}(window,function(e,t,n,r){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist",n(n.s=4)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),s=n(0),i=n.n(s),a=n(3),l=n.n(a);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const p="undefined"!=typeof performance&&performance.now?()=>performance.now():()=>Date.now();function h(e){return`${e}px`}class d extends r.PureComponent{constructor(e){super(e),this.state={contentHeight:0},this.moveMarquee=this.moveMarquee.bind(this),this.handleResize=this.handleResize.bind(this)}componentDidMount(){this.animationFrameRequest=requestAnimationFrame(this.moveMarquee),this.marqueeContainerElementWidth=getComputedStyle(this.marqueeContainerElement).width;const e=getComputedStyle(this.movingContentContainerElement);this.movingContentContainerElementWidth=e.width,this.setState({contentHeight:e.height}),this.resizeObserver=new l.a(this.handleResize),this.resizeObserver.observe(this.marqueeContainerElement),this.resizeObserver.observe(this.movingContentContainerElement),this.lastMovementTime=p()}componentWillUnmount(){cancelAnimationFrame(this.animationFrameRequest),this.resizeObserver.disconnect()}moveMarquee(){const e=this.props,t=e.pixelsPerSecond,n=e.scrollDirection,r=p(),o=r-this.lastMovementTime;if(this.lastMovementTime=r,"left"===n?this.movingContentContainerElement.style.right=void 0:this.movingContentContainerElement.style.left=void 0,this.marqueeContainerElementWidth>=this.movingContentContainerElementWidth)this.movingContentContainerElement.style[n]=0;else{const e=t*o/1e3,r=function(e){return Number(e.slice(0,-2))}(this.movingContentContainerElement.style[n])-e;r>0-this.movingContentContainerElementWidth?this.movingContentContainerElement.style[n]=h(r):this.movingContentContainerElement.style[n]=h(this.marqueeContainerElementWidth)}this.animationFrameRequest=requestAnimationFrame(this.moveMarquee)}handleResize(e){for(const t of e)t.target===this.marqueeContainerElement&&(this.marqueeContainerElementWidth=t.contentRect.width),t.target===this.movingContentContainerElement&&(this.movingContentContainerElementWidth=t.contentRect.width,this.setState({contentHeight:t.contentRect.height}))}render(){const e=this.props,t=e.content,n=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["content"]);return delete n.pixelsPerSecond,delete n.scrollDirection,o.a.createElement("div",c({},n,{ref:e=>this.marqueeContainerElement=e,style:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){u(e,t,n[t])})}return e}({position:"relative",overflow:"hidden",height:this.state.contentHeight},n.style||{})}),o.a.createElement("div",{ref:e=>this.movingContentContainerElement=e,style:{position:"absolute",whiteSpace:"nowrap"}},t))}}d.propTypes={content:i.a.node.isRequired,pixelsPerSecond:i.a.number.isRequired,scrollDirection:i.a.oneOf(["left","right"]).isRequired},d.defaultProps={pixelsPerSecond:30,scrollDirection:"left"};var m=d,g=n(2);var f=function(e,t){const n=`${100*(1-(e||0))}%`,r={position:"absolute",left:0,right:0,top:0,bottom:0};switch(t){case"left":r.left=n,r.willChange="left";break;case"right":r.right=n,r.willChange="right";break;case"up":r.top=n,r.willChange="top";break;case"down":r.bottom=n,r.willChange="bottom"}return r};var y=function(e,t){const n=`${100*(e||0)}%`,r={position:"absolute",transform:"translate(-50%, -50%)"};switch(t){case"left":r.top="50%",r.right=n,r.willChange="right",r.transform="translate(50%, -50%)";break;case"right":r.top="50%",r.left=n,r.willChange="left",r.transform="translate(-50%, -50%)";break;case"up":r.left="50%",r.bottom=n,r.willChange="bottom",r.transform="translate(-50%, 50%)";break;case"down":r.left="50%",r.top=n,r.willChange="top",r.transform="translate(-50%, -50%)"}return r};function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const C=Object(r.forwardRef)((e,t)=>{let n=e.progressClassName,r=e.progressStyle,s=e.progress,i=e.progressDirection,a=e.handle,l=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["progressClassName","progressStyle","progress","progressDirection","handle"]);return o.a.createElement("div",b({},l,{ref:t}),o.a.createElement("div",{style:{position:"relative",width:"100%",height:"100%",touchAction:"none"}},o.a.createElement("div",{className:n,style:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){v(e,t,n[t])})}return e}({},f(s,i),r||{})}),a&&o.a.createElement("div",{style:y(s,i)},a)))});C.propTypes={progressClassName:i.a.string,progressStyle:i.a.object,progress:i.a.number.isRequired,progressDirection:g.PlayerPropTypes.progressDirection.isRequired,handle:i.a.element};var O=C;function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}const w="\ncursor: default;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  -webkit-touch-callout: none;\n";class j extends r.PureComponent{constructor(e){super(e),this.progressContainer=null,this.setProgressContainerRef=this.setProgressContainerRef.bind(this),this.handleAdjustProgress=this.handleAdjustProgress.bind(this),this.handleAdjustComplete=this.handleAdjustComplete.bind(this)}componentDidMount(){window.addEventListener("mousemove",this.handleAdjustProgress),document.addEventListener("touchmove",this.handleAdjustProgress),window.addEventListener("mouseup",this.handleAdjustComplete),document.addEventListener("touchend",this.handleAdjustComplete),setTimeout(()=>{const e=document.createElement("style"),t=`noselect_${Math.random().toString(16).slice(2,7)}`;e.innerText=`.${t}{${w}}`,document.body.appendChild(e),this.noselectStyleElement=e,this.noselectClassName=t})}componentWillUnmount(){window.removeEventListener("mousemove",this.handleAdjustProgress),document.removeEventListener("touchmove",this.handleAdjustProgress),window.removeEventListener("mouseup",this.handleAdjustComplete),document.removeEventListener("touchend",this.handleAdjustComplete),this.toggleNoselect(!1),this.noselectStyleElement.parentNode.removeChild(this.noselectStyleElement)}setProgressContainerRef(e){this.progressContainer=e}toggleNoselect(e){document.body.classList[e?"add":"remove"](this.noselectClassName)}getProgressFromPageCoordinates(e,t){const n=this.progressContainer.getBoundingClientRect(),r=n.left,o=n.top,s=n.width,i=n.height,a=document.body,l=a.scrollLeft,c=a.scrollTop;switch(this.props.progressDirection){case"down":return(t-o-c)/i;case"left":return 1-(e-r-l)/s;case"up":return 1-(t-o-c)/i;case"right":default:return(e-r-l)/s}}handleAdjustProgress(e){const t=this.props,n=t.readonly,r=t.adjusting,o=t.onAdjustProgress;if(n)return;if("mousedown"===e.type||"touchstart"===e.type)this.toggleNoselect(!0);else if(!r)return;e.preventDefault();const s="touch"===e.type.slice(0,5),i=s?e.targetTouches.item(0).pageX:e.pageX,a=s?e.targetTouches.item(0).pageY:e.pageY,l=this.getProgressFromPageCoordinates(i,a);o(Object(g.convertToNumberWithinIntervalBounds)(l,0,1))}handleAdjustComplete(e){const t=this.props,n=t.adjusting,r=t.onAdjustComplete;this.toggleNoselect(!1),n&&(e.preventDefault(),"function"==typeof r&&r())}render(){const e=this.props,t=e.progressClassName,n=e.progressStyle,r=e.progress,s=e.progressDirection,i=e.handle,a=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["progressClassName","progressStyle","progress","progressDirection","handle"]);return delete a.adjusting,delete a.readonly,delete a.onAdjustProgress,delete a.onAdjustComplete,o.a.createElement(O,P({},a,{ref:this.setProgressContainerRef,progressClassName:t,progressStyle:n,progress:r,progressDirection:s,handle:i,onMouseDown:this.handleAdjustProgress,onTouchStart:this.handleAdjustProgress}))}}j.propTypes={progressClassName:i.a.string,progressStyle:i.a.object,progress:i.a.number.isRequired,progressDirection:g.PlayerPropTypes.progressDirection.isRequired,handle:i.a.element,adjusting:i.a.bool.isRequired,readonly:i.a.bool.isRequired,onAdjustProgress:i.a.func.isRequired,onAdjustComplete:i.a.func.isRequired},j.defaultProps={readonly:!1};var R=j;function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const E="#000";class q extends r.PureComponent{constructor(e){super(e),this.state={realDisplayWidth:0,realDisplayHeight:0,containerWidth:0,containerHeight:0}}componentDidMount(){this.canvas.width=0,this.canvas.height=0,this.checkForBadStuff();const e=this.getDeviceDisplayDimensions(),t=e.imageResolutionX,n=e.imageResolutionY,r=this.props.pipeVideoStreamToCanvas(this.canvas,this.handleFrameUpdate.bind(this)),o=r.endStream,s=r.setCanvasSize,i=r.setPlaceholderImage;s(t,n),this.getPlaceholderImage(i),this.endStream=o,this.setCanvasSize=s,this.setPlaceholderImage=i,this.updateContainerDimensions(),this.containerResizeObserver=new l.a(this.updateContainerDimensions.bind(this)),this.containerResizeObserver.observe(this.containerElement)}componentDidUpdate(){this.checkForBadStuff();const e=this.getDeviceDisplayDimensions(),t=e.imageResolutionX,n=e.imageResolutionY;this.setCanvasSize(t,n),this.getPlaceholderImage(this.setPlaceholderImage)}componentWillUnmount(){this.endStream(),this.containerResizeObserver.disconnect()}checkForBadStuff(){this.warnedAboutBadStuff||!this.props.processFrame||this.props.imageResolutionX||this.props.imageResolutionY||(Object(g.logWarning)("VideoDisplay: Supplying a processFrame function without also giving a imageResolutionX or imageResolutionY means the video will be processed at the full resolution. This may lead to a poor framerate."),this.warnedAboutBadStuff=!0)}updateContainerDimensions(){const e=this.containerElement,t=e.offsetWidth,n=e.offsetHeight;this.setState(e=>t===e.containerWidth&&n===e.containerHeight?null:{containerWidth:t,containerHeight:n})}getDeviceDisplayDimensions(){const e=this.props,t=e.imageResolutionX,n=e.imageResolutionY,r=e.scaleForDevicePixelRatio&&window.devicePixelRatio||1;return{imageResolutionX:t&&r*t,imageResolutionY:n&&r*n}}getPlaceholderImage(e){const t=this.props,n=t.playlist,r=t.activeTrackIndex,o=(0,t.getPlaceholderImageForTrack)(n[r]||null);o?o.naturalWidth&&o.naturalHeight?e(o):(o.addEventListener("load",()=>e(o)),o.addEventListener("error",()=>e())):e()}handleFrameUpdate(e,t){const n=this.canvas,r=n.width,o=n.height;if(r&&o&&this.setState(e=>r===e.realDisplayWidth&&o===e.realDisplayHeight?null:{realDisplayWidth:r,realDisplayHeight:o}),!(this.props.processFrame&&r&&o))return;if(!t&&!this.props.shouldProcessPlaceholderImages)return;const s=e.getImageData(0,0,r,o),i=this.props.processFrame(s);i instanceof ImageData?e.putImageData(i,0,0):this.warnedAboutNoImageData||(Object(g.logWarning)("The processFrame function should return an ImageData object. Normally you'll just mutate the provided ImageData and return it."),this.warnedAboutNoImageData=!0)}render(){const e=this.props,t=e.aspectRatio,n=e.fullscreen,r=e.maintainAspectRatioInFullscreen,s=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["aspectRatio","fullscreen","maintainAspectRatioInFullscreen"]);delete s.pipeVideoStreamToCanvas,delete s.processFrame,delete s.imageResolutionX,delete s.imageResolutionY,delete s.scaleForDevicePixelRatio,delete s.playlist,delete s.activeTrackIndex,delete s.getPlaceholderImageForTrack,delete s.shouldProcessPlaceholderImages;const i=this.state,a=i.realDisplayWidth,l=i.realDisplayHeight,c=i.containerWidth,u=i.containerHeight,p={};if(a&&l&&c&&u){const e=a/l,t=c/u;e===t?(p.width=c,p.height=u):e>t?(p.width=c,p.height=c/e):(p.height=u,p.width=u*e)}const h=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){S(e,t,n[t])})}return e}({display:"flex",justifyContent:"center",alignItems:"center",background:E},s.style||{});return t&&c&&(!n||r)&&(h.height&&!this.warnedAboutStyleOverride&&(Object(g.logWarning)("VideoDisplay cannot style.height prop which is overridden by aspectRatio."),this.warnedAboutStyleOverride=!0),h.height=c/function(e){const t=e.split(":").map(Number);return t[0]/t[1]}(t)),o.a.createElement("div",D({},s,{style:h,ref:e=>this.containerElement=e}),o.a.createElement("canvas",{style:p,ref:e=>this.canvas=e}))}}q.propTypes={pipeVideoStreamToCanvas:i.a.func.isRequired,playlist:i.a.arrayOf(g.PlayerPropTypes.track.isRequired).isRequired,activeTrackIndex:i.a.number.isRequired,fullscreen:i.a.bool,processFrame:i.a.func,imageResolutionX:i.a.number,imageResolutionY:i.a.number,scaleForDevicePixelRatio:i.a.bool.isRequired,aspectRatio:g.PlayerPropTypes.aspectRatio,getPlaceholderImageForTrack:i.a.func.isRequired,shouldProcessPlaceholderImages:i.a.bool.isRequired,maintainAspectRatioInFullscreen:i.a.bool.isRequired},q.defaultProps={scaleForDevicePixelRatio:!0,aspectRatio:"16:9",getPlaceholderImageForTrack(e){if(e&&e.artwork){const t=new Image;return t.src=e.artwork[0].src,t}},shouldProcessPlaceholderImages:!1,maintainAspectRatioInFullscreen:!1};var x=Object(g.playerContextFilter)(q,["pipeVideoStreamToCanvas","playlist","activeTrackIndex","fullscreen"]);n.d(t,"MaybeMarquee",function(){return m}),n.d(t,"ProgressBar",function(){return R}),n.d(t,"ProgressBarDisplay",function(){return O}),n.d(t,"VideoDisplay",function(){return x})}])});
//# sourceMappingURL=cassette-components.min.js.map